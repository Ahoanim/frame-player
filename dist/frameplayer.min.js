var FramePlayer=function(e,t){this.divCont=document.getElementById(e),this.elem=e,this.jsonVideoSrc=this.divCont.getAttribute("data-vidsrc"),this.rate=20,this.controls=!0,this.paused=!1,this.width="480px",this.height="320px",this.backwards=!1,this.radius=null,this.setOptions(t),this.initializeRequestAnimationFrame()};FramePlayer.prototype.setOptions=function(e){if("rate"in e&&(this.rate=e.rate),"controls"in e&&(this.controls=e.controls),"autoplay"in e&&(e.autoplay||(this.paused=!0)),"width"in e&&(this.width=e.width),"height"in e&&(this.height=e.height),"backwards"in e&&(this.backwards=e.backwards),"radius"in e){var t=document.createElement("style");t.setAttribute("id","style-"+this.elem),t.innerHTML="#"+this.elem+", .frames-"+this.elem+"{ border-radius: "+e.radius+"; overflow: hidden;}",document.head.appendChild(t)}this.divCont.style.width=this.width,this.divCont.style.height=this.height,this.controls&&this.createControlBar()},FramePlayer.prototype.render=function(e,t){var n,i,a=Date.now(),s=1e3/t.rate,r=e.frames.length,o=-1,l=document.createElement("img");t.canvas=document.createElement("canvas"),t.context=t.canvas.getContext("2d"),t.divCont.appendChild(t.canvas);var d=function(){n=Date.now(),i=n-a,i>s&&(a=n-i%s,t.paused||(o=t.backwards?o-=1:o+=1,o>=r?o=0:0>o&&(o=r-1),l.src=e.frames[o],t.context.drawImage(l,0,0,t.canvas.width,t.canvas.height))),window.requestAnimationFrame(d)};window.requestAnimationFrame(d)},FramePlayer.prototype.createControlBar=function(){var e=this,t=document.createElement("div");t.setAttribute("class","fp-ctrl"),t.style.width=this.width;var n=document.createElement("button");n.setAttribute("id","pause-"+e.elem),n.setAttribute("class","fp-btn"),n.innerHTML="Pause",n.addEventListener("click",function(){e.pause()},!1),t.appendChild(n);var i=document.createElement("button");i.setAttribute("id","play-"+e.elem),i.setAttribute("class","fp-btn"),i.innerHTML="Play",i.addEventListener("click",function(){e.resume()},!1),t.appendChild(i);var a=document.createElement("button");a.setAttribute("id","backwards-"+e.elem),a.setAttribute("class","fp-btn"),a.innerHTML="Backward",a.addEventListener("click",function(){e.reverse()},!1),t.appendChild(a),e.paused?n.style.display="none":i.style.display="none";for(var s=document.createElement("select"),r=["normal","grayscale","sepia","invert"],o=0,l=r.length;l>o;o++){var d=document.createElement("option");d.setAttribute("value",r[o]),d.innerHTML=r[o],s.appendChild(d)}s.setAttribute("id","filter-"+e.elem),s.setAttribute("class","fp-select"),s.addEventListener("change",function(){e.setFilter(this.value)},!1),t.appendChild(s),this.divCont.appendChild(t)},FramePlayer.prototype.play=function(){this.getFile(this.jsonVideoSrc,this.render)},FramePlayer.prototype.resume=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="none",t.style.display="block",this.paused=!1},FramePlayer.prototype.pause=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="block",t.style.display="none",this.paused=!0},FramePlayer.prototype.reverse=function(){var e=document.getElementById("backwards-"+this.elem);this.backwards=!this.backwards,value=this.backwards?"Forward":"Backward",e.innerHTML=value},FramePlayer.prototype.setFilter=function(e){var t=document.querySelector("#"+this.elem+" canvas");switch(e){case"normal":t.setAttribute("class","");break;case"grayscale":t.setAttribute("class","fp-grayscale");break;case"sepia":t.setAttribute("class","fp-sepia");break;case"invert":t.setAttribute("class","fp-invert")}},FramePlayer.prototype.getFile=function(e,t){var n=new XMLHttpRequest,i=this,a=document.createElement("p");if(!n)throw"Error loading file.";n.open("GET",e,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(null),n.onprogress=function(){a.innerHTML="Loading...",a.setAttribute("class","fp-loading"),i.divCont.appendChild(a)},void 0!==typeof n.onload?n.onload=function(){i.divCont.removeChild(a),t(JSON.parse(this.responseText),i),n=null}:n.onreadystatechange=function(){4===n.readyState&&(i.divCont.removeChild(a),t(JSON.parse(this.responseText),i),n=null)}},FramePlayer.prototype.initializeRequestAnimationFrame=function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),a=Math.max(0,16-(i-e)),s=window.setTimeout(function(){t(i+a)},a);return e=i+a,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})};